apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
commonLabels:
  argocd/app-name: ${{ values.name }}
  janus-idp.io/tekton: ${{ values.name }}
  backstage.io/kubernetes-id: ${{ values.name }}
  backstage.io/kubernetes-namespace: ${{ values.namespace }}
  app.kubernetes.io/part-of: ${{ values.name }}
resources:
  {%- if not values.deployOnRemoteCluster %}
  - initialize-namespace/
  {%- endif %}
  # RBAC for MCP Server
  - rbac-mcp-server.yaml
  # ConfigMaps (run.yaml and ingestion-config.yaml are baked into images)
  - configmap-app.yaml
  - configmap-llama-stack-env.yaml
  # NOTE: Secrets are user-managed - see TechDocs for example
  # Llama Stack Server
  - deployment-llama-stack.yaml
  - service-llama-stack.yaml
  # Kubernetes MCP Server
  - deployment-mcp-server.yaml
  - service-mcp-server.yaml
  # Main Streamlit Application
  - deployment.yaml
  - service.yaml
  - route.yaml
  {%- if values.safetyModel.startsWith('ollama/') %}
  # Ollama Server (for inference and/or safety shields)
  - deployment-ollama.yaml
  - service-ollama.yaml
  - pvc-ollama.yaml
  {%- endif %}

